(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const D=4.18,te=287.058,ne=461.52;function we(e){const s=e+273.15;if(s<=273.15||s>=647.096)return s<=273.15?611.21*Math.exp((18.678-e/234.5)*(e/(257.14+e))):0;const o=647.096,t=22064e3,n=s/o,i=[-7.85951783,1.84408259,-11.7866497,22.6807411,-15.9618719,1.80122502],r=1-n,d=i[0]*r+i[1]*Math.pow(r,1.5)+i[2]*Math.pow(r,3)+i[3]*Math.pow(r,3.5)+i[4]*Math.pow(r,4)+i[5]*Math.pow(r,7.5);return t*Math.exp(o/s*d)}function Ee(e){const s=e;return 1.00315*s+1306e-7*Math.pow(s,2)-46545e-12*Math.pow(s,3)+16368e-15*Math.pow(s,4)}function be(e){e<0&&(e=0),e>370&&(e=370);const s=e;return 2500.8+1.8325*s-551e-6*Math.pow(s,2)+3205e-9*Math.pow(s,3)-758e-11*Math.pow(s,4)}function M(e,s){e<0&&(e=0);const o=s*1e5,t=e+273.15;let a=o*(-16318e-12+21268e-15*t+-61558e-19*Math.pow(t,2))+(1.0006+1579e-7*t+-16387e-10*Math.pow(t,2));return a<.95&&(a=.95),a>1.15&&(a=1.15),a}function Le(e,s,o){const t=e+273.15,n=s*1e5,i=(.3344-364.2/t-75800/Math.pow(t,2))*1e-5,r=(-.198-1928/t)*1e-5,d=o/(.62198+o),l=1-d;return 1+(l*i+d*r)*n/((te*l+ne*d)*t)}function A(e){return we(e)}function We(e,s,o){const t=s+273.15,n=e*1e5,i=A(s),d=M(s,e)*i;let l=o/100*d;l>=n&&(l=n*.999);let u=n-l;u<0&&(u=0);const a=u<=0?10:.62198*(l/u),m=(te+a*ne)/(1+a),c=Le(s,e,a);if(c===0||m===0||t===0){const p=u/(te*t),g=l/(ne*t);return p+g}return n/(c*m*t)}function Re(e,s,o){const t=e*1e5,n=A(s),r=M(s,e)*n;let d=o/100*r;d>=t&&(d=t*.999);const l=t-d;return l<=0?10:.62198*(d/l)}function De(e,s){(isNaN(s)||s<0)&&(s=0);const o=Ee(e),t=be(e);return o+s*t}function Ve(e,s,o){s=Math.max(.1,Math.min(100,s));const t=A(e),n=M(e,o),i=s/100*n*t;if(i<1)return-100;let r=-100,d=e,l=e/2;const u=M(d,o)*A(d);if(i>=u)return e;for(let a=0;a<10;a++){l=(r+d)/2;const m=A(l);M(l,o)*m-i>0?d=l:r=l}return l}function Ge(e){return e<=0?2501:e>=374?0:Math.max(0,2501.6-2.369*e+.0018*e*e-4e-6*e*e*e)}function Ue(e,s){const o=e*1e5;return s=Math.max(0,s),s*o/(.62198+s)}const Qe=Object.freeze(Object.defineProperty({__proto__:null,getAirDensity:We,getAirEnthalpy:De,getCompressibilityFactor:Le,getDewPoint:Ve,getDryAirEnthalpy_HighAccuracy:Ee,getEnhancementFactor:M,getHumidityRatio:Re,getSatVaporPressure:A,getSatVaporPressure_HighAccuracy:we,getSteamLatentHeat:Ge,getVaporEnthalpy_HighAccuracy:be,getVaporPressure:Ue},Symbol.toStringTag,{value:"Module"})),{getDryAirEnthalpy_HighAccuracy:ge,getVaporEnthalpy_HighAccuracy:je,getEnhancementFactor:Ke,getSatVaporPressure:q,getAirDensity:Ie,getHumidityRatio:C,getAirEnthalpy:Q,getDewPoint:$e,getSteamLatentHeat:xe,getVaporPressure:ye}=Qe;let I=[],k=null,$=null;const V=document.getElementById("hpCalcForm"),b=document.getElementById("calcButton"),Ce=document.getElementById("resetButton"),J=document.getElementById("results"),h=document.getElementById("resultMessage"),j=document.getElementById("resultData");document.querySelectorAll('input[name="calcMode"]');document.querySelectorAll('input[name="inputType"]');const Be=document.getElementById("sourceType"),Te=document.getElementById("sinkType"),ze=document.getElementById("sourceAirParams"),Je=document.getElementById("sinkAirParams"),Ze=document.getElementById("sinkTempGroup"),Xe=document.getElementById("sinkSteamParams"),Ye=document.getElementById("etaType"),et=document.getElementById("customEtaGroup"),tt=document.getElementById("customCopGroup"),nt=document.getElementById("sourceFlowGroup"),st=document.getElementById("sinkFlowGroup"),ot=document.getElementById("sourceLoadGroup"),it=document.getElementById("sinkLoadGroup"),se=document.getElementById("sourceResultGroup"),oe=document.getElementById("sinkResultGroup"),ie=document.getElementById("sinkAirHumidPotGroup"),re=document.getElementById("sinkAirRHOutGroup"),de=document.getElementById("sinkEnergyEvapCapGroup"),le=document.getElementById("sinkRHAfterHumidGroup"),w=document.getElementById("sourceUnit"),E=document.getElementById("sinkUnit"),K=document.getElementById("resultActions"),rt=document.getElementById("saveCaseButton"),dt=document.getElementById("printSingleButton"),ae=document.getElementById("comparisonSection"),Ne=document.getElementById("comparisonTableContainer"),lt=document.getElementById("printComparisonButton"),at=document.getElementById("clearCasesButton");let B={source:w.value,sink:E.value};w.addEventListener("mousedown",()=>{B.source=w.value});E.addEventListener("mousedown",()=>{B.sink=E.value});w.addEventListener("change",e=>{const s=e.target.value,o=B.source;Se(document.getElementById("sourceFlow"),o,s,Be.value),B.source=s});E.addEventListener("change",e=>{const s=e.target.value,o=B.sink;Se(document.getElementById("sinkFlow"),o,s,Te.value),B.sink=s});function Z(){const e=document.querySelector('input[name="calcMode"]:checked').value,s=document.querySelector('input[name="inputType"]:checked').value,o=Be.value,t=Te.value;e==="source"?document.body.classList.add("mode-source-active"):document.body.classList.remove("mode-source-active"),ze.classList.toggle("hidden",o!=="air"),Je.classList.toggle("hidden",t!=="air"),Ze.classList.toggle("hidden",t==="steam"),Xe.classList.toggle("hidden",t!=="steam"),nt.classList.toggle("hidden",!(e==="source"&&s==="flow")),ot.classList.toggle("hidden",!(e==="source"&&s==="load")),st.classList.toggle("hidden",!(e==="sink"&&s==="flow")),it.classList.toggle("hidden",!(e==="sink"&&s==="load")),o==="water"?(w.options[0].disabled=!1,w.options[1].disabled=!1,w.options[2].disabled=!1):o==="air"&&(w.options[0].disabled=!0,w.options[1].disabled=!1,w.options[2].disabled=!1,w.value==="t/h"&&(w.value="m3/h")),t==="water"||t==="steam"?(E.options[0].disabled=!1,E.options[1].disabled=!1,E.options[2].disabled=!1):t==="air"&&(E.options[0].disabled=!0,E.options[1].disabled=!1,E.options[2].disabled=!1,E.value==="t/h"&&(E.value="m3/h")),B.source=w.value,B.sink=E.value;const n=Ye.value;et.classList.toggle("hidden",n!=="custom_eta"),tt.classList.toggle("hidden",n!=="custom_cop")}function Oe(e,s=!0,o=[]){if(J.classList.remove("hidden"),h.classList.remove("hidden","bg-red-100","text-red-700","bg-green-100","text-green-700","bg-yellow-100","text-yellow-700","opacity-0"),h.classList.add("opacity-100"),s)k=null,$=null,K.classList.add("hidden"),j.classList.add("hidden"),h.classList.add("bg-red-100","text-red-700"),h.innerHTML=`<span class="font-bold">计算失败：</span> ${e}`,ct();else{j.classList.remove("hidden"),h.classList.add("bg-green-100","text-green-700");let t="";o&&o.length>0&&(t=`<div class="mt-2 p-3 text-sm rounded-md border text-left" style="background-color: #fffbeb; color: #92400e; border-color: #fde68a;">
                               <b>物理约束警告：</b><br>${o.join("<br>")}
                           </div>`),h.innerHTML=`<span class="font-bold">计算成功：</span> ${e} ${t}`,K.classList.remove("hidden")}}function ct(){["resFeasibility","resSourceSensible","resSourceLatent","resSourceWater","resSinkParam1Value","resSinkParam2Value","resSinkParam3Value","resSinkAirHumidPot","resSinkAirRHOut","resSinkEnergyEvapCap","resSinkRHAfterHumid","resQcold","resQhot","resW","resSourceFlow","resSinkFlow","resCopActual","resCopCarnot","resEta"].forEach(o=>{const t=document.getElementById(o);t&&(t.textContent="---")});const s=document.getElementById("resFeasibility");s&&(s.className="font-bold text-lg text-gray-700"),se&&se.classList.add("hidden"),oe&&oe.classList.add("hidden"),ie&&ie.classList.add("hidden"),re&&re.classList.add("hidden"),de&&de.classList.add("hidden"),le&&le.classList.add("hidden")}function ce(e){if(Oe(e.message,!e.feasibility,e.warnings||[]),!e.feasibility)return;const s=(d,l=2)=>d===null||typeof d>"u"||isNaN(d)?"---":d.toFixed(l),o=d=>`${s(d,2)} kW`,t=d=>`${s(d,3)} kg/h`,n=d=>`${s(d,1)} %`,i=document.getElementById("resFeasibility");i.textContent=e.feasibility?"可行":"不可行",i.className=e.feasibility?"font-bold text-lg text-green-600":"font-bold text-lg text-red-600",se.classList.toggle("hidden",e.source.type!=="air"),e.source.type==="air"&&(document.getElementById("resSourceSensible").textContent=o(e.source.qSensible),document.getElementById("resSourceLatent").textContent=o(e.source.qLatent),document.getElementById("resSourceWater").textContent=t(Math.abs(e.source.water_kg_h))),oe.classList.toggle("hidden",e.sink.type!=="air"&&e.sink.type!=="steam");const r=e.sink.type==="air";if(ie.classList.toggle("hidden",!r),re.classList.toggle("hidden",!r),de.classList.toggle("hidden",!r),le.classList.toggle("hidden",!r),r)document.getElementById("resSinkParam1Label").textContent="显热负荷 (Q_sens)：",document.getElementById("resSinkParam1Value").textContent=o(e.sink.qSensible),document.getElementById("resSinkParam2Label").textContent="潜热负荷 (Q_lat)：",document.getElementById("resSinkParam2Value").textContent=o(e.sink.qLatent),document.getElementById("resSinkParam3Label").textContent="加湿/除湿水量：",document.getElementById("resSinkParam3Value").textContent=t(e.sink.water_kg_h),document.getElementById("resSinkAirHumidPot").textContent=t(e.sink.maxHumidPot_kg_h),document.getElementById("resSinkAirRHOut").textContent=n(e.sink.rhOut_noHumid),document.getElementById("resSinkEnergyEvapCap").textContent=t(e.sink.energyEvapCap_kg_h),document.getElementById("resSinkRHAfterHumid").textContent=n(e.sink.rhOut_afterHumid);else if(e.sink.type==="steam"){const d=q(e.sink.steamTemp)/1e5;document.getElementById("resSinkParam1Label").textContent="饱和压力：",document.getElementById("resSinkParam1Value").textContent=`${s(d,3)} bara`,document.getElementById("resSinkParam2Label").textContent="显热负荷 (Q_sens)：",document.getElementById("resSinkParam2Value").textContent=o(e.sink.qSensible),document.getElementById("resSinkParam3Label").textContent="潜热负荷 (Q_lat)：",document.getElementById("resSinkParam3Value").textContent=o(e.sink.qLatent)}document.getElementById("resQcold").textContent=o(e.qCold_kW),document.getElementById("resQhot").textContent=o(e.qHot_kW),document.getElementById("resW").textContent=o(e.W_kW),document.getElementById("resSourceFlow").textContent=e.flow.sourceFlow!==null?`${s(e.flow.sourceFlow)} ${e.flow.sourceUnit}`:"---",document.getElementById("resSinkFlow").textContent=e.flow.sinkFlow!==null?`${s(e.flow.sinkFlow)} ${e.flow.sinkUnit}`:"---",document.getElementById("resCopActual").textContent=s(e.copActual,2),document.getElementById("resCopCarnot").textContent=s(e.copCarnotMax,2),document.getElementById("resEta").textContent=`${s(e.etaActual*100,1)} %`}function Se(e,s,o,t){if(s===o)return;const n=parseFloat(e.value);if(isNaN(n)||n===0)return;let i;if(s==="t/h"?i=t==="air"?NaN:n:s==="L/min"?i=n*60/1e3:i=n,isNaN(i)){console.warn(`Conversion error: Cannot convert from ${s} for ${t}`);return}let r;if(o==="t/h"?r=t==="air"?NaN:i:o==="L/min"?r=i*1e3/60:r=i,isNaN(r)){console.warn(`Conversion error: Cannot convert to ${o} for ${t}`);return}e.value=parseFloat(r.toFixed(3))}V.addEventListener("change",Z);let ee=null;V.addEventListener("input",()=>{ee&&clearTimeout(ee),ee=setTimeout(()=>{J.classList.contains("hidden")||(h.classList.remove("hidden","bg-red-100","text-red-700","bg-green-100","text-green-700","opacity-0"),h.classList.add("bg-yellow-100","text-yellow-700","opacity-100"),h.innerHTML='<span class="font-bold">注意：</span> 输入参数已更改，请重新计算！',j.classList.add("hidden"),K.classList.add("hidden"),k=null,$=null,b.classList.remove("bg-[var(--color-action)]","hover:bg-orange-800"),b.classList.add("bg-yellow-500","hover:bg-yellow-600","animate-pulse"))},300)});Ce.addEventListener("click",()=>{V.reset(),J.classList.add("hidden"),h.classList.add("hidden"),j.classList.add("hidden"),K.classList.add("hidden"),b.classList.remove("bg-yellow-500","hover:bg-yellow-600","animate-pulse"),b.classList.add("bg-[var(--color-action)]","hover:bg-orange-800"),document.getElementById("mode_source").checked=!0,document.getElementById("type_flow").checked=!0,document.getElementById("etaType").value="0.55",k=null,$=null,Pe(),Z()});b.addEventListener("click",ue);rt.addEventListener("click",ft);at.addEventListener("click",Pe);dt.addEventListener("click",()=>{if(!k||!$||!$.feasibility){alert("没有可打印的有效计算报告。");return}try{pt(),document.body.classList.remove("printing-comparison"),document.body.classList.add("printing-single-report"),window.print(),setTimeout(()=>{document.body.classList.remove("printing-single-report"),document.getElementById("printReportContainer").innerHTML=""},500)}catch(e){console.error("Error generating print report:",e),alert("生成打印报告时出错："+e.message)}});lt.addEventListener("click",gt);function ue(){b.classList.remove("bg-yellow-500","hover:bg-yellow-600","animate-pulse"),b.classList.add("bg-[var(--color-action)]","hover:bg-orange-800");try{const e=new FormData(V),s=Object.fromEntries(e.entries()),o=ut(s),t=o.mode==="source"&&o.inputType==="flow"?z(o.source,!0,!0):{type:o.source.type,q_kW:NaN,qSensible:NaN,qLatent:NaN,water_kg_h:0},n=o.mode==="sink"&&o.inputType==="flow"?z(o.sink,!0,!1):{type:o.sink.type,steamTemp:o.sink.steamTemp,q_kW:NaN,qSensible:NaN,qLatent:NaN,water_kg_h:0},i=mt(o,t,n);k=o,$=i,ce(i)}catch(e){console.error("Calculation Error:",e),Oe(e.message||"发生未知计算错误，请检查输入参数。")}}function ut(e){const s=[],o=[],t={mode:e.calcMode,inputType:e.inputType,source:{},sink:{},eta:{},minTempApproach:3,steamTempApproach:5},n=(r,d,l=!1,u=-1/0,a=1/0)=>{if(r===null||String(r).trim()==="")return s.push(`${d} 不能为空。`),NaN;const m=parseFloat(r);return isNaN(m)||!l&&m<=0||m<u||m>a?(s.push(`${d} 必须是有效数字 (范围 ${u} ~ ${a})。`),NaN):m},i=(r,d,l=-1/0,u=1/0)=>{if(r===null||String(r).trim()==="")return null;const a=parseFloat(r);return isNaN(a)||a<l||a>u?(s.push(`${d} (选填) 必须是有效数字 (范围 ${l} ~ ${u})。`),NaN):a};if(t.source.type=e.sourceType,t.source.tempIn=n(e.sourceTempIn,"热源·进口温度",!0,-100,300),t.source.tempOut=n(e.sourceTempOut,"热源·出口温度",!0,-100,300),!isNaN(t.source.tempIn)&&!isNaN(t.source.tempOut)&&t.source.tempIn<=t.source.tempOut&&s.push("热源：进口温度必须高于出口温度。"),t.mode==="source"&&(t.inputType==="flow"?(t.source.flow=n(e.sourceFlow,"热源·可用流量"),t.source.unit=e.sourceUnit):t.source.load=n(e.sourceLoad,"热源·可用负荷")),t.source.type==="air"&&(t.source.pressure=n(e.sourceAirPressure,"热源·空气压力",!0,.1,20),t.source.rh=n(e.sourceAirRH,"热源·相对湿度",!0,0,100),!isNaN(t.source.tempIn)&&!isNaN(t.source.pressure)&&!isNaN(t.source.rh))){const r=t.source.pressure*1e5,d=q(t.source.tempIn);if(d>r){const l=r/d*100;t.source.rh>l&&o.push(`热源侧：在 ${t.source.tempIn}°C 和 ${t.source.pressure} bara 下，最大物理 RH 约为 ${l.toFixed(1)}%。输入值 ${t.source.rh}% 将按 ${l.toFixed(1)}% 极限值计算。`)}}if(t.sink.type=e.sinkType,t.sink.type==="steam")t.sink.steamTemp=n(e.sinkSteamTemp,"热汇·饱和蒸汽温度",!0,1,250),t.sink.makeupTemp=n(e.sinkMakeupWaterTemp,"热汇·补水温度",!0,-20,100),!isNaN(t.sink.makeupTemp)&&!isNaN(t.sink.steamTemp)&&t.sink.makeupTemp>=t.sink.steamTemp&&s.push("补水温度必须低于饱和蒸汽温度。");else if(t.sink.tempIn=n(e.sinkTempIn,"热汇·进口温度",!0,-100,300),t.sink.tempOut=n(e.sinkTempOut,"热汇·目标温度",!0,-100,300),!isNaN(t.sink.tempIn)&&!isNaN(t.sink.tempOut)&&t.sink.tempIn>=t.sink.tempOut&&s.push("热汇：进口温度必须低于目标温度。"),t.sink.type==="air"){if(t.sink.pressure=n(e.sinkAirPressure,"热汇·空气压力",!0,.1,20),t.sink.rh=n(e.sinkAirRH,"热汇·(进口)相对湿度",!0,0,100),t.sink.rhOut=i(e.sinkAirRHOut,"热汇·目标相对湿度",0,100),!isNaN(t.sink.tempIn)&&!isNaN(t.sink.pressure)&&!isNaN(t.sink.rh)){const r=t.sink.pressure*1e5,d=q(t.sink.tempIn);if(d>r){const l=r/d*100;t.sink.rh>l&&o.push(`热汇侧：在 ${t.sink.tempIn}°C 和 ${t.sink.pressure} bara 下，最大物理 RH 约为 ${l.toFixed(1)}%。输入值 ${t.sink.rh}% 将按 ${l.toFixed(1)}% 极限值计算。`)}}if(t.sink.rhOut!==null&&!isNaN(t.sink.rhOut)&&!isNaN(t.sink.tempOut)&&!isNaN(t.sink.pressure)){const r=t.sink.pressure*1e5,d=q(t.sink.tempOut);if(d>r){const l=r/d*100;t.sink.rhOut>l&&(o.push(`热汇侧：在 ${t.sink.tempOut}°C 和 ${t.sink.pressure} bara 下，最大物理 RH 约为 ${l.toFixed(1)}%。目标RH ${t.sink.rhOut}% 将按 ${l.toFixed(1)}% 极限值计算。`),t.sink.rhOut=l)}}}if(t.mode==="sink"&&(t.inputType==="flow"?(t.sink.flow=n(e.sinkFlow,"热汇·需求流量"),t.sink.unit=e.sinkUnit):t.sink.load=n(e.sinkLoad,"热汇·需求负荷")),t.eta.type=e.etaType,t.eta.type==="custom_eta"?t.eta.customEta=n(e.customEta,"自定义 η",!1,.01,.99):t.eta.type==="custom_cop"?t.eta.customCop=n(e.customCop,"自定义 COP",!1,1.01):t.eta.customEta=parseFloat(t.eta.type),t.source.tempOut,t.sink.type==="steam"?t.sink.steamTemp:t.sink.tempIn,t.warnings=o,s.length>0)throw new Error(s.join("<br>"));return t}function F(e,s,o){if(!s||s<=0)throw new Error("用于反算流量的负荷无效。");if(e.type==="water"){const t=o?e.tempIn-e.tempOut:e.tempOut-e.tempIn;if(t<=0)throw new Error(o?"热源水侧温差必须大于0。":"热汇水侧温差必须大于0。");return{flow:s/(D*t)*3600/1e3,unit:"t/h"}}else if(e.type==="air"){const t=C(e.pressure,e.tempIn,e.rh),n=Q(e.tempIn,t);let i=t;o&&e.tempOut<$e(e.tempIn,e.rh,e.pressure)?i=C(e.pressure,e.tempOut,100):!o&&e.tempOut>e.tempIn&&e.rhOut!==null&&typeof e.rhOut<"u"&&(i=C(e.pressure,e.tempOut,e.rhOut));const r=Q(e.tempOut,i),d=o?n-r:r-n;if(d===0)throw new Error(o?"热源空气焓差为0，无法反算流量。":"热汇空气焓差为0，无法反算流量。");if(o&&d<=0)throw new Error("热源空气焓差必须大于0。");if(!o&&d<=0)throw new Error("热汇空气总焓变必须大于0 (加热或加湿)。");const l=s/d,u=Ie(e.pressure,e.tempIn,e.rh);return{flow:l*(1+t)*3600/u,unit:"m³/h"}}else if(e.type==="steam"&&!o){const t=xe(e.steamTemp),n=D*(e.steamTemp-e.makeupTemp),i=t+n;if(i<=0)throw new Error("热汇蒸汽总焓升必须大于0。");return{flow:s/i*3600/1e3,unit:"t/h"}}throw new Error("无法计算流量：未知的介质类型或配置。")}function z(e,s,o){let t={type:e.type,mass_dry_air_kg_s:NaN,q_kW:NaN,qSensible:NaN,qLatent:NaN,water_kg_h:0};const n=e.flow,i=e.unit;if(e.type==="water"){const r=o?e.tempIn-e.tempOut:e.tempOut-e.tempIn;{let d=NaN;if(i==="t/h")d=n*1e3/3600;else if(i==="L/min")d=n/60;else if(i==="m3/h")d=n*1e3/3600;else throw new Error(`(热源: ${o}) 水介质的流量单位无效: ${i}。`);t.mass_dry_air_kg_s=d,t.q_kW=t.mass_dry_air_kg_s*D*r}t.qSensible=t.q_kW,t.qLatent=0}else if(e.type==="air"){const r=C(e.pressure,e.tempIn,e.rh),d=Q(e.tempIn,r);let l=r;o&&e.tempOut<$e(e.tempIn,e.rh,e.pressure)?l=C(e.pressure,e.tempOut,100):!o&&e.tempOut>e.tempIn&&e.rhOut!==null&&typeof e.rhOut<"u"&&(l=C(e.pressure,e.tempOut,e.rhOut));const u=Q(e.tempOut,l),a=o?d-u:u-d;{const m=Ie(e.pressure,e.tempIn,e.rh);let c;if(i==="m3/h"||i==="m³/h")c=n*m/3600;else if(i==="L/min")c=n/1e3/60*m;else throw new Error(`(热源: ${o}) 空气介质的流量单位无效: ${i} (应为 m³/h 或 L/min)。`);t.mass_dry_air_kg_s=c/(1+r),t.q_kW=t.mass_dry_air_kg_s*a;const p=t.mass_dry_air_kg_s,g=ge(e.tempIn),y=ge(e.tempOut)-g;t.qSensible=p*Math.abs(y),t.qLatent=t.q_kW-t.qSensible,t.water_kg_h=p*(l-r)*3600,Math.abs(t.qLatent)<1e-6&&(t.qLatent=0),Math.abs(t.water_kg_h)<1e-6&&(t.water_kg_h=0),t.qLatent<0&&t.q_kW>0&&console.warn(`Negative latent heat (${t.qLatent} kW) calculated for ${o?"source":"sink"}. Resetting. Q_sensible adjusted.`)}}else if(e.type==="steam"&&!o){const r=xe(e.steamTemp),d=D*(e.steamTemp-e.makeupTemp),l=r+d;{let u;if(i==="t/h")u=n*1e3/3600;else if(i==="L/min")u=n/60;else if(i==="m3/h")u=n*1e3/3600;else throw new Error(`热汇·蒸汽介质的流量单位无效: ${i}。`);t.mass_dry_air_kg_s=u,t.q_kW=t.mass_dry_air_kg_s*l,t.qSensible=t.mass_dry_air_kg_s*d,t.qLatent=t.mass_dry_air_kg_s*r}}return t}function mt(e,s,o){const{source:t,sink:n,eta:i,minTempApproach:r,steamTempApproach:d,mode:l,inputType:u}=e;let a,m,c,p,g,v,y,f,L,P=null,T=null,N=null,H=null,G={...s},O={...o};const me=t.tempOut-r,pe=n.type==="steam"?n.steamTemp+d:n.tempOut+r,fe=me+273.15,X=pe+273.15;if(fe>=X)throw new Error(`热力学不可能：估算蒸发 (${me.toFixed(1)}°C) >= 冷凝 (${pe.toFixed(1)}°C)。`);const Y=X/(X-fe);if(i.type==="custom_cop"?(p=i.customCop,g=p/Y):(g=i.customEta,p=Y*g),p<=1)throw new Error(`实际 COP (${p.toFixed(2)}) <= 1，不可行。`);if(l==="source"&&u==="flow"){if(a=s.q_kW,!a||a<=0)throw new Error("无法确定有效的制冷量。");c=a/(p-1),m=a+c,v=t.flow,y=t.unit;const{flow:_,unit:x}=F(n,m,!1);f=_,L=x}else if(l==="source"&&u==="load"){a=e.source.load,c=a/(p-1),m=a+c;const{flow:_,unit:x}=F(t,a,!0);v=_,y=x;const{flow:S,unit:R}=F(n,m,!1);f=S,L=R}else if(l==="sink"&&u==="flow"){if(m=o.q_kW,!m||m<=0)throw new Error("无法确定有效的制热量。");c=m/p,a=m-c;const{flow:_,unit:x}=F(t,a,!0);v=_,y=x,f=n.flow,L=n.unit}else{m=e.sink.load,c=m/p,a=m-c;const{flow:_,unit:x}=F(t,a,!0);v=_,y=x;const{flow:S,unit:R}=F(n,m,!1);f=S,L=R}if(G=z({...t,flow:v,unit:y},!0,!0),O=z({...n,flow:f,unit:L},!0,!1),n.type==="air")try{const _=C(n.pressure,n.tempIn,n.rh),x=C(n.pressure,n.tempOut,100);if(isNaN(O.mass_dry_air_kg_s)||O.mass_dry_air_kg_s<=0)throw new Error("无法计算干空气质量流量 (mass_dry_air_kg_s invalid)。");const S=O.mass_dry_air_kg_s;P=S*(x-_)*3600,P=Math.max(0,P);const R=q(n.tempOut),He=Ke(n.tempOut,n.pressure),U=R*He,Fe=ye(n.pressure,_);U>0?(T=Fe/U*100,T=Math.max(0,Math.min(100,T))):T=0;const he=je(n.tempOut)-D*n.tempOut;he>0?(N=m/he*3600,N=Math.max(0,N)):N=0;const Me=Math.min(P,N)/3600,Ae=S>0?_+Me/S:_,qe=ye(n.pressure,Ae);U>0?(H=qe/U*100,H=Math.max(0,Math.min(100,H))):H=0,n.rhOut!==null&&typeof n.rhOut<"u"&&(T=n.rhOut)}catch(_){console.error("Error calculating additional air sink parameters:",_),P=null,T=null,N=null,H=null}return{feasibility:!0,message:"初步匹配计算完成。",warnings:e.warnings||[],source:{type:t.type,qSensible:G.qSensible,qLatent:G.qLatent,water_kg_h:G.water_kg_h},sink:{type:n.type,steamTemp:n.steamTemp,qSensible:O.qSensible,qLatent:O.qLatent,water_kg_h:O.water_kg_h,maxHumidPot_kg_h:P,rhOut_noHumid:T,energyEvapCap_kg_h:N,rhOut_afterHumid:H},qCold_kW:a,qHot_kW:m,W_kW:c,copActual:p,copCarnotMax:Y,etaActual:g,flow:{sourceFlow:v,sourceUnit:y,sinkFlow:f,sinkUnit:L}}}function pt(){const e=document.getElementById("printReportContainer");if(!e||!k||!$)throw new Error("Report container or data not found.");const s=k,o=$,t={name:document.getElementById("projectName").value||"未命名项目",desc:document.getElementById("projectDesc").value||"无"},n=(f,L=2)=>f===null||typeof f>"u"||isNaN(f)?"---":f.toFixed(L),i=f=>`${n(f,2)} kW`,r=f=>`${n(f,3)} kg/h`,d=f=>`${n(f,1)} %`,l=(f,L)=>f[L]||L,u=l({water:"水",air:"空气"},s.source.type),a=l({water:"水",air:"空气",steam:"蒸汽"},s.sink.type),m=l({source:"已知热源 (算热汇)",sink:"已知热汇 (算热源)"},s.mode),c=l({flow:"按流量计算",load:"按负荷计算"},s.inputType);let p="---";s.eta.type==="custom_eta"?p=`自定义 η (${n(s.eta.customEta,2)})`:s.eta.type==="custom_cop"?p=`自定义 COP (${n(s.eta.customCop,1)})`:p=`η = ${s.eta.type} (典型水平)`;const g=o.feasibility?"res-feasibility-ok":"res-feasibility-fail",v=s.sink.type==="air"&&s.sink.rhOut!==null&&typeof s.sink.rhOut<"u"?`<div><dt>热汇·目标RH：</dt><dd>${d(s.sink.rhOut)}</dd></div>`:"";let y=`
        <h1>工业热泵匹配计算报告</h1>
    
        <div class="report-section report-section-single">
            <h2>1. 项目信息</h2>
            <dl>
                <dt>项目名称：</dt><dd>${t.name}</dd>
                <dt>项目描述：</dt><dd>${t.desc}</dd>
            </dl>
        </div>

        <div class="report-section report-section-single">
            <h2>2. 计算结果总览</h2>
            <dl>
                <dt>匹配可行性：</dt><dd class="${g}">${o.feasibility?"可行":"不可行"}</dd>
                <dt>热泵制冷量 (Q_cold)：</dt><dd>${i(o.qCold_kW)}</dd>
                <dt>热泵制热量 (Q_hot)：</dt><dd class="res-qhot">${i(o.qHot_kW)}</dd>
                <dt>所需压缩机功 (W)：</dt><dd>${i(o.W_kW)}</dd>
                <dt>估算实际 COP_hot：</dt><dd class="res-cop">${n(o.copActual,2)}</dd>
                <dt>热力完善度 (η)：</dt><dd>${d(o.etaActual*100)}</dd>
            </dl>
        </div>
    
        <div class="report-section">
            <h2>3. 核心输入参数</h2>
            <div class="report-grid">
                <div class="report-subsection">
                    <h3>热源 (Source)</h3>
                    <dl>
                        <div><dt>介质类型：</dt><dd>${u}</dd></div>
                        <div><dt>进口温度：</dt><dd>${n(s.source.tempIn,1)} °C</dd></div>
                        <div><dt>出口温度：</dt><dd>${n(s.source.tempOut,1)} °C</dd></div>
                        ${s.source.type==="air"?`
                            <div><dt>空气压力：</dt><dd>${n(s.source.pressure,3)} bara</dd></div>
                            <div><dt>相对湿度：</dt><dd>${n(s.source.rh,1)} %</dd></div>
                        `:""}
                    </dl>
                </div>
                <div class="report-subsection">
                    <h3>热汇 (Sink)</h3>
                    <dl>
                        <div><dt>介质类型：</dt><dd>${a}</dd></div>
                        ${s.sink.type==="steam"?`
                            <div><dt>饱和蒸汽温度：</dt><dd>${n(s.sink.steamTemp,1)} °C</dd></div>
                            <div><dt>补水温度：</dt><dd>${n(s.sink.makeupTemp,1)} °C</dd></div>
                        `:`
                            <div><dt>进口温度：</dt><dd>${n(s.sink.tempIn,1)} °C</dd></div>
                            <div><dt>目标温度：</dt><dd>${n(s.sink.tempOut,1)} °C</dd></div>
                        `}
                        ${s.sink.type==="air"?`
                            <div><dt>空气压力：</dt><dd>${n(s.sink.pressure,3)} bara</dd></div>
                            <div><dt>进口RH：</dt><dd>${n(s.sink.rh,1)} %</dd></div>
                            ${v} 
                        `:""}
                    </dl>
                </div>
                <div class="report-subsection">
                    <h3>计算基准</h3>
                    <dl>
                        <div><dt>计算模式：</dt><dd>${m}</dd></div>
                        <div><dt>计算基准：</dt><dd>${c}</dd></div>
                        ${s.mode==="source"&&s.inputType==="flow"?`
                            <div><dt>热源·可用流量：</dt><dd>${n(s.source.flow)} ${s.source.unit}</dd></div>
                        `:""}
                        ${s.mode==="source"&&s.inputType==="load"?`
                            <div><dt>热源·可用负荷：</dt><dd>${i(s.source.load)}</dd></div>
                        `:""}
                        ${s.mode==="sink"&&s.inputType==="flow"?`
                            <div><dt>热汇·需求流量：</dt><dd>${n(s.sink.flow)} ${s.sink.unit}</dd></div>
                        `:""}
                        ${s.mode==="sink"&&s.inputType==="load"?`
                            <div><dt>热汇·需求负荷：</dt><dd>${i(s.sink.load)}</dd></div>
                        `:""}
                    </dl>
                </div>
                <div class="report-subsection">
                    <h3>性能估算</h3>
                    <dl>
                        <div><dt>估算方式：</dt><dd>${p}</dd></div>
                        <div><dt>卡诺(极限) COP_hot：</dt><dd>${n(o.copCarnotMax,2)}</dd></div>
                    </dl>
                </div>
            </div>
        </div>
        
        <div class="report-section">
            <h2>4. 详细输出参数</h2>
            <div class="report-grid">
                <div class="report-subsection">
                    <h3>流量计算</h3>
                    <dl>
                        <div><dt>热源·计算流量：</dt><dd>${n(o.flow.sourceFlow)} ${o.flow.sourceUnit}</dd></div>
                        <div><dt>热汇·计算流量：</dt><dd>${n(o.flow.sinkFlow)} ${o.flow.sinkUnit}</dd></div>
                    </dl>
                </div>
                <div class="report-subsection">
                    <h3>热源特性 (空气)</h3>
                    <dl>
                        ${s.source.type==="air"?`
                            <div><dt>显热负荷 (Q_sens)：</dt><dd>${i(o.source.qSensible)}</dd></div>
                            <div><dt>潜热负荷 (Q_lat)：</dt><dd>${i(o.source.qLatent)}</dd></div>
                            <div><dt>析出水量：</dt><dd>${r(o.source.water_kg_h)}</dd>
                        `:`
                            <div><dt> (热源介质为水)</dt><dd>---</dd></div>
                        `}
                    </dl>
                </div>
                <div class="report-subsection">
                    <h3>热汇特性 (空气/蒸汽)</h3>
                    <dl>
                        ${s.sink.type==="steam"?`
                            <div><dt>饱和压力：</dt><dd>${n(q(s.sink.steamTemp)/1e5,3)} bara</dd></div>
                            <div><dt>显热负荷 (Q_sens)：</dt><dd>${i(o.sink.qSensible)}</dd></div>
                            <div><dt>潜热负荷 (Q_lat)：</dt><dd>${i(o.sink.qLatent)}</dd></div>
                        `:s.sink.type==="air"?`
                            <div><dt>显热负荷 (Q_sens)：</dt><dd>${i(o.sink.qSensible)}</dd></div>
                            <div><dt>潜热负荷 (Q_lat)：</dt><dd>${i(o.sink.qLatent)}</dd></div>
                            <div><dt>加湿/除湿水量：</dt><dd>${r(o.sink.water_kg_h)}</dd></div>
                            <div><dt>空气吸湿潜力：</dt><dd>${r(o.sink.maxHumidPot_kg_h)}</dd></div>
                            <div><dt>加热后RH(或目标RH)：</dt><dd>${d(o.sink.rhOut_noHumid)}</dd></div>
                            <div><dt>能量约束蒸发能力：</dt><dd>${r(o.sink.energyEvapCap_kg_h)}</dd></div>
                            <div><dt>最大加湿后RH：</dt><dd>${d(o.sink.rhOut_afterHumid)}</dd></div>
                        `:`
                            <div><dt> (热汇介质为水)</dt><dd>---</dd></div>
                        `}
                    </dl>
                </div>
            </div>
        </div>
    `;e.innerHTML=y}function ft(){if(!k||!$){W("没有可暂存的有效计算结果。","warning");return}const e={inputs:JSON.parse(JSON.stringify(k)),result:JSON.parse(JSON.stringify($))};I.push(e),ht(),h.classList.remove("hidden","bg-red-100","text-red-700","bg-green-100","text-green-700","bg-yellow-100","text-yellow-700","opacity-0"),h.classList.add("bg-blue-100","text-blue-700","opacity-100"),h.innerHTML=`<span class="font-bold">方案 ${I.length} 已暂存。</span> 可在页面底部查看对比。`,W(`方案 ${I.length} 已暂存`,"success")}function ht(){if(I.length===0){ae.classList.add("hidden");return}ae.classList.remove("hidden");const e=(o,t=2)=>o===null||typeof o>"u"||isNaN(o)?"---":o.toFixed(t);let s='<table class="comparison-table">';s+=`
        <thead>
            <tr>
                <th>方案</th>
                <th>基准</th>
                <th>热源</th>
                <th>热源 T_in (°C)</th>
                <th>热源 T_out (°C)</th>
                <th>热汇</th>
                <th>热汇 T_in (°C)</th>
                <th>热汇 T_out (°C)</th>
                <th>Q_cold (kW)</th>
                <th>Q_hot (kW)</th>
                <th>W (kW)</th>
                <th>COP_hot</th>
                <th>η (%)</th>
            </tr>
        </thead>
    `,s+="<tbody>",I.forEach((o,t)=>{const n=o.inputs,i=o.result,r=n.mode==="source"?"已知热源":"已知热汇",d=n.inputType==="flow"?"按流量":"按负荷",l=n.sink.type==="steam"?n.sink.makeupTemp:n.sink.tempIn,u=n.sink.type==="steam"?n.sink.steamTemp:n.sink.tempOut;s+=`
            <tr>
                <td>${t+1}</td>
                <td>${r} /<br>${d}</td>
                <td>${n.source.type==="air"?"空气":"水"}</td>
                <td>${e(n.source.tempIn,1)}</td>
                <td>${e(n.source.tempOut,1)}</td>
                <td>${n.sink.type==="air"?"空气":n.sink.type==="steam"?"蒸汽":"水"}</td>
                <td>${e(l,1)}</td>
                <td>${e(u,1)}</td>
                <td class="param-output">${e(i.qCold_kW)}</td>
                <td class="param-output param-qhot">${e(i.qHot_kW)}</td>
                <td class="param-output">${e(i.W_kW)}</td>
                <td class="param-output param-cop">${e(i.copActual)}</td>
                <td class="param-output">${e(i.etaActual*100,1)}</td>
            </tr>
        `}),s+="</tbody></table>",Ne.innerHTML=s}function Pe(){const e=()=>{const s=I.length;I=[],Ne.innerHTML="",ae.classList.add("hidden"),h&&(h.classList.contains("bg-green-100")||h.classList.contains("bg-blue-100"))&&(h.classList.add("hidden"),h.innerHTML=""),s>0&&W("所有方案已清空","info")};I.length>0?confirm(`确定要清空所有 ${I.length} 个已暂存的方案吗？`)&&e():e()}function gt(){if(I.length===0){alert("没有可打印的对比方案。");return}document.body.classList.add("printing-comparison"),window.print(),setTimeout(()=>{document.body.classList.remove("printing-comparison")},500)}function W(e,s="info",o=3e3){const t=document.getElementById("toastContainer");if(!t)return;const n=document.createElement("div");n.className=`toast ${s}`;const i={success:'<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',error:'<svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',warning:'<svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>',info:'<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'};n.innerHTML=`
        ${i[s]||i.info}
        <span class="flex-1 text-sm text-gray-700">${e}</span>
        <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    `,t.appendChild(n),setTimeout(()=>{n.classList.add("fade-out"),setTimeout(()=>n.remove(),300)},o)}function _e(e){const s=e.value.trim(),o=e.name,t=e.parentElement.nextElementSibling;if(e.classList.remove("error","success"),t&&t.classList.contains("error-message")&&(t.classList.add("hidden"),t.textContent=""),!s&&!e.required)return!0;let n=!0,i="";if(o.includes("Temp")){const r=parseFloat(s);isNaN(r)?(n=!1,i="请输入有效数字"):(r<-100||r>300)&&(n=!1,i="温度范围：-100°C ~ 300°C")}if(o.includes("RH")){const r=parseFloat(s);isNaN(r)?(n=!1,i="请输入有效数字"):(r<0||r>100)&&(n=!1,i="相对湿度范围：0% ~ 100%")}if(o.includes("Pressure")){const r=parseFloat(s);isNaN(r)?(n=!1,i="请输入有效数字"):(r<.1||r>20)&&(n=!1,i="压力范围：0.1 ~ 20 bara")}if(o.includes("Flow")||o.includes("Load")){const r=parseFloat(s);(isNaN(r)||r<=0)&&(n=!1,i="请输入大于0的有效数字")}return n&&s?e.classList.add("success"):n||(e.classList.add("error"),t&&t.classList.contains("error-message")&&(t.textContent=i,t.classList.remove("hidden"))),n}function yt(){const e=V.querySelectorAll('input[type="number"], input[type="text"], textarea'),s=new Map;e.forEach(o=>{o.addEventListener("blur",()=>_e(o)),o.addEventListener("input",()=>{if(o.classList.contains("error")){o.classList.remove("error");const n=o.parentElement.nextElementSibling;n&&n.classList.contains("error-message")&&n.classList.add("hidden")}s.has(o)&&clearTimeout(s.get(o));const t=setTimeout(()=>{document.activeElement!==o&&_e(o)},500);s.set(o,t)})})}function _t(){document.addEventListener("keydown",e=>{e.key==="Enter"&&!e.target.matches('textarea, input[type="text"]')&&(e.preventDefault(),b.disabled||b.click()),e.key==="Escape"&&Ce.click()})}function kt(){document.getElementById("projectName").value="示例项目",document.getElementById("projectDesc").value="这是一个示例项目，用于演示计算器的功能",document.getElementById("mode_source").checked=!0,document.getElementById("type_flow").checked=!0,document.getElementById("sourceType").value="water",document.getElementById("sourceTempIn").value="30",document.getElementById("sourceTempOut").value="25",document.getElementById("sourceFlow").value="100",document.getElementById("sourceUnit").value="t/h",document.getElementById("sinkType").value="water",document.getElementById("sinkTempIn").value="50",document.getElementById("sinkTempOut").value="70",document.getElementById("etaType").value="0.55",Z(),W("示例数据已填充","success")}function ke(e){const s=document.getElementById("calcLoadingSpinner"),o=b.querySelector("span");e?(b.disabled=!0,s.classList.remove("hidden"),o.textContent="计算中..."):(b.disabled=!1,s.classList.add("hidden"),o.textContent="开始计算")}function vt(e){const s=document.getElementById("resultCharts");!s||!e.feasibility||(s.classList.remove("hidden"),requestAnimationFrame(()=>{const o=document.getElementById("energyChartCanvas");if(o){const n=o.getContext("2d"),i=o.width=o.offsetWidth||300,r=o.height=o.offsetHeight||200,d=i/2,l=r/2,u=Math.min(i,r)/2-10;n.clearRect(0,0,i,r);const a=e.qHot_kW||0,m=e.W_kW||0,c=a+m;if(c>0){const p=a/c*2*Math.PI;n.beginPath(),n.moveTo(d,l),n.arc(d,l,u,0,p),n.closePath(),n.fillStyle="#dc2626",n.fill(),n.beginPath(),n.moveTo(d,l),n.arc(d,l,u,p,2*Math.PI),n.closePath(),n.fillStyle="#f59e0b",n.fill(),n.fillStyle="#fff",n.font="12px sans-serif",n.textAlign="center",n.fillText(`Q_hot: ${a.toFixed(1)}kW`,d,l-10),n.fillText(`W: ${m.toFixed(1)}kW`,d,l+10)}}const t=document.getElementById("tempChartCanvas");if(t&&k){const n=t.getContext("2d"),i=t.width=t.offsetWidth||300,r=t.height=t.offsetHeight||200;n.clearRect(0,0,i,r);const d=k.source.tempIn||0,l=k.source.tempOut||0,u=k.sink.tempIn||0,a=k.sink.tempOut||0,m=Math.max(d,l,u,a,100),c=i/4-10,p=r-40,g=d/m*p;n.fillStyle="#2563eb",n.fillRect(10,r-g-20,c,g),n.fillStyle="#000",n.font="10px sans-serif",n.fillText("源入",10+c/2-10,r-5),n.fillText(d.toFixed(1)+"°C",10+c/2-15,r-g-25);const v=l/m*p;n.fillStyle="#3b82f6",n.fillRect(20+c,r-v-20,c,v),n.fillStyle="#000",n.fillText("源出",20+c+c/2-10,r-5),n.fillText(l.toFixed(1)+"°C",20+c+c/2-15,r-v-25);const y=u/m*p;n.fillStyle="#dc2626",n.fillRect(30+c*2,r-y-20,c,y),n.fillStyle="#000",n.fillText("汇入",30+c*2+c/2-10,r-5),n.fillText(u.toFixed(1)+"°C",30+c*2+c/2-15,r-y-25);const f=a/m*p;n.fillStyle="#ef4444",n.fillRect(40+c*3,r-f-20,c,f),n.fillStyle="#000",n.fillText("汇出",40+c*3+c/2-10,r-5),n.fillText(a.toFixed(1)+"°C",40+c*3+c/2-15,r-f-25)}}))}function wt(e){if(!e.feasibility)return;const s=document.querySelector("#copProgressBar > div"),o=document.getElementById("copProgressBar");if(s&&e.copActual&&e.copCarnotMax){const i=Math.min(e.copActual/e.copCarnotMax*100,100);s.style.width=i+"%",o.classList.remove("hidden")}const t=document.querySelector("#etaProgressBar > div"),n=document.getElementById("etaProgressBar");if(t&&e.etaActual){const i=e.etaActual*100;t.style.width=i+"%",n.classList.remove("hidden")}}const Et=ce;ce=function(e){Et(e),e.feasibility&&(W("计算完成！","success"),setTimeout(()=>{vt(e),wt(e)},100),J.scrollIntoView({behavior:"smooth",block:"nearest"}))};const bt=ue;ue=function(){ke(!0),setTimeout(()=>{try{bt()}catch(e){W("计算失败："+e.message,"error")}finally{ke(!1)}},100)};const ve=document.getElementById("fillExampleButton");ve&&ve.addEventListener("click",kt);Z();yt();_t();console.log("工业热泵匹配计算器 V5.8.0 (UI/UX升级版) 初始化完成。");
